name: Deploy to GitHub Pages

on:
  push:
    branches: [main]  # Este flujo de trabajo se ejecutará cuando se haga push a la rama main.
  workflow_dispatch:  # Permite ejecutar este flujo de trabajo manualmente desde la pestaña Actions en GitHub.

permissions:
  contents: read  # Permite leer el contenido del repositorio.
  pages: write  # Permite desplegar en GitHub Pages.
  id-token: write  # Necesario para autenticarse al despliegue.

jobs:
  build:
    runs-on: ubuntu-latest  # El trabajo se ejecutará en una máquina virtual con Ubuntu.
    
    steps:
      - name: Checkout your repository using git
        uses: actions/checkout@v4  # Checkout del código del repositorio.

      - name: Set up Node.js
        uses: actions/setup-node@v4  # Configura Node.js en la versión 20.
        with:
          node-version: '20'  # Especifica que se usará Node.js versión 20.

      - name: Install dependencies
        run: npm install  # Instala las dependencias del proyecto desde package.json.

      - name: Build the site with Astro
        run: npm run build  # Ejecuta el script de construcción (se asegura de que el sitio se construya correctamente con Astro).

  deploy:
    needs: build  # El trabajo de despliegue depende de que el trabajo de construcción se haya completado con éxito.
    runs-on: ubuntu-latest  # Se ejecuta en una máquina virtual con Ubuntu.

    environment:
      name: github-pages  # Define el entorno de despliegue.
      url: ${{ steps.deployment.outputs.page_url }}  # URL del sitio desplegado en GitHub Pages.

    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4  # Usa la acción de GitHub para desplegar el contenido a GitHub Pages.
